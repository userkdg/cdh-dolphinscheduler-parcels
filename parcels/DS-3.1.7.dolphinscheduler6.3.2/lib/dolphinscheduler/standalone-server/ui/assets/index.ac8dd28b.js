import{u as N,b5 as R,a as c,bq as j,t as m,d as C,e as P,w as E,_,ba as x,c as l}from"./index.ccaa682a.js";import{_ as D}from"./lodash.02988b15.js";import{B as U}from"./index.c1fd473c.js";import{d as z,e as O,f as v}from"./index.40a25123.js";import{e as I}from"./index.126e1851.js";import K from"./table-action.16c292d1.js";import{b as W,r as y,d as V}from"./common.0c468cf3.js";import{D as A,C as s,c as B}from"./column-width-config.d330f121.js";import{N as q}from"./Ellipsis.31968545.js";import{N as L}from"./Icon.808259cb.js";import{N as M}from"./Spin.6c6d001b.js";import{N as S}from"./Tooltip.14e7654c.js";import{C as b}from"./index.76253dc2.js";import $ from"./process-instance-condition.452eceee.js";import{N as T}from"./Space.f435ce00.js";import{N as F,a as G}from"./DataTable.f685dba1.js";import{N as H}from"./Button.3394f0e3.js";import{N as X}from"./Popconfirm.b8629776.js";import"./service.ae1ed8a7.js";import"./FormOutlined.bdfa4274.js";import"./SyncOutlined.20c34c75.js";import"./CloseCircleOutlined.7f4d3411.js";import"./PlayCircleOutlined.f08ba79f.js";import"./PauseCircleOutlined.f81cacab.js";import"./InfoCircleFilled.bb7f9c24.js";import"./DeleteOutlined.b64cb1c2.js";import"./ControlOutlined.82afa1d6.js";import"./Popover.b48d5d17.js";import"./index.99c68204.js";import"./flatten.995f807f.js";import"./Scrollbar.0dc514b7.js";import"./fade-in.cssr.ac08f6bb.js";import"./VResizeObserver.c3d2397d.js";import"./utils.381519a7.js";import"./format-length.a0cbed4d.js";import"./resolve-slot.d8d7b3cb.js";import"./use-compitable.d1fd83c6.js";import"./next-frame-once.e5ee25e8.js";import"./is-browser.f4bc45cf.js";import"./use-rtl.d43d8217.js";import"./use-locale.ca4c738c.js";import"./keysOf.10525521.js";import"./get-slot.7f666ba0.js";import"./index.7a579f81.js";import"./SettingOutlined.675e55ec.js";import"./CheckCircleOutlined.b6132804.js";import"./EditOutlined.84f6aa5d.js";import"./index.15a20265.js";import"./Card.915ef7d2.js";import"./SearchOutlined.2201cd30.js";import"./Input.f12e0137.js";import"./Suffix.584d00eb.js";import"./Select.a0f44759.js";import"./fade-in-scale-up.cssr.5995d390.js";import"./Selection.57d091a8.js";import"./DatePicker.34177339.js";import"./use-keyboard.db487137.js";import"./Forward.6cc09413.js";import"./ArrowDown.c45c82c0.js";import"./Checkbox.ff1b56b7.js";import"./RadioGroup.8830dbe4.js";import"./Radio.0f909e72.js";import"./Dropdown.16d7f975.js";import"./ChevronRight.efc71575.js";function Y(){const{t:o}=N(),a=j(),e=R({columns:[],tableWidth:A,checkedRowKeys:[],tableData:[],page:c(1),pageSize:c(10),totalPage:c(1),searchVal:c(),executorName:c(),host:c(),stateType:c(),startDate:c(),endDate:c(),projectCode:c(Number(a.currentRoute.value.params.projectCode)),loadingRef:c(!1)}),u=r=>{r.columns=[{type:"selection",className:"btn-selected",...s.selection},{title:"#",key:"id",...s.index,render:(t,i)=>i+1},{title:o("project.workflow.workflow_instance_name"),key:"name",...s.linkName,className:"workflow-name",render:t=>m(U,{onClick:()=>void a.push({name:"workflow-instance-detail",params:{id:t.id},query:{code:t.processDefinitionCode}})},{default:()=>m(q,s.linkEllipsis,()=>t.name)})},{title:o("project.workflow.status"),key:"state",...s.state,className:"workflow-status",render:t=>J(t.state,o)},{title:o("project.workflow.run_type"),key:"commandType",width:160,className:"workflow-run-type",render:t=>(D.filter(W(o),i=>i.code===t.commandType)[0]||{}).desc},{title:o("project.workflow.scheduling_time"),key:"scheduleTime",...s.time,render:t=>y(t.scheduleTime)},{title:o("project.workflow.start_time"),key:"startTime",...s.time,render:t=>y(t.startTime)},{title:o("project.workflow.end_time"),key:"endTime",...s.time,render:t=>y(t.endTime)},{title:o("project.workflow.duration"),key:"duration",...s.duration,render:t=>t.duration||"-"},{title:o("project.workflow.run_times"),key:"runTimes",...s.times,className:"workflow-run-times"},{title:o("project.workflow.fault_tolerant_sign"),key:"recovery",width:100},{title:o("project.workflow.dry_run_flag"),key:"dryRun",...s.dryRun,render:t=>t.dryRun===1?"YES":"NO"},{title:o("project.workflow.executor"),key:"executorName",...s.name},{title:o("project.workflow.host"),key:"host",...s.name},{title:o("project.workflow.operation"),key:"operation",...s.operation(7),render:(t,i)=>m(K,{row:t,onReRun:()=>n({index:i,processInstanceId:t.id,executeType:"REPEAT_RUNNING",buttonType:"run"}),onReStore:()=>n({index:i,processInstanceId:t.id,executeType:"START_FAILURE_TASK_PROCESS",buttonType:"store"}),onStop:()=>{t.state==="STOP"?n({index:i,processInstanceId:t.id,executeType:"RECOVER_SUSPENDED_PROCESS",buttonType:"suspend"}):w({processInstanceId:t.id,executeType:"STOP"})},onSuspend:()=>{t.state==="PAUSE"?n({index:i,processInstanceId:t.id,executeType:"RECOVER_SUSPENDED_PROCESS",buttonType:"suspend"}):w({processInstanceId:t.id,executeType:"PAUSE"})},onDeleteInstance:()=>d(t.id)})}],r.tableWidth&&(r.tableWidth=B(r.columns))},p=()=>{if(e.loadingRef)return;e.loadingRef=!0;const r={pageNo:e.page,pageSize:e.pageSize,searchVal:e.searchVal,executorName:e.executorName,host:e.host,stateType:e.stateType,startDate:e.startDate,endDate:e.endDate};z({...r},e.projectCode).then(t=>{e.totalPage=t.totalPage,e.tableData=t.totalList.map(i=>({...i})),e.loadingRef=!1})},d=r=>{O(r,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),e.tableData.length===1&&e.page>1&&(e.page-=1),p()})},k=()=>{const r={processInstanceIds:D.join(e.checkedRowKeys,",")};v(r,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),e.tableData.length===e.checkedRowKeys.length&&e.page>1&&(e.page-=1),e.checkedRowKeys=[],p()})},w=r=>{I(r,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),p()})},g=(r,t)=>{let h,f;h||(f=10,h=setInterval(()=>{f>0&&f<=10?(f--,e.tableData[t].count=f):(r(),clearInterval(h),h=void 0)},1e3))},n=r=>{const{index:t}=r;e.tableData[t].buttonType=r.buttonType,I(r,e.projectCode).then(()=>{e.tableData[t].disabled=!0,window.$message.success(o("project.workflow.success")),g(()=>{p()},t)})};return{variables:e,createColumns:u,getTableData:p,batchDeleteInstance:k}}function J(o,a){if(!o)return"";const e=V(a)[o],u=m(L,{color:e.color,class:e.classNames,style:{display:"flex"},size:20},()=>m(e.icon));return m(S,null,{trigger:()=>e.isSpin?m(M,{size:20},{icon:()=>u}):u,default:()=>e.desc})}const ct=C({name:"WorkflowInstanceList",setup(){let o;const{variables:a,createColumns:e,getTableData:u,batchDeleteInstance:p}=Y(),d=()=>{u()},k=n=>{a.searchVal=n.searchVal,a.executorName=n.executorName,a.host=n.host,a.stateType=n.stateType,a.startDate=n.startDate,a.endDate=n.endDate,a.page=1,d()},w=()=>{a.page=1,d()},g=()=>{p()};return P(()=>{e(a),d(),o=setInterval(()=>{d()},9e3)}),E(N().locale,()=>{e(a)}),_(()=>{clearInterval(o)}),{requestData:d,handleSearch:k,handleChangePageSize:w,handleBatchDelete:g,...x(a)}},render(){const{t:o}=N(),{loadingRef:a}=this;return l(T,{vertical:!0},{default:()=>[l(b,null,{default:()=>[l($,{onHandleSearch:this.handleSearch},null)]}),l(b,{title:o("project.workflow.workflow_instance")},{default:()=>[l(T,{vertical:!0},{default:()=>[l(F,{loading:a,rowKey:e=>e.id,columns:this.columns,data:this.tableData,striped:!0,size:"small",scrollX:this.tableWidth,"checked-row-keys":this.checkedRowKeys,"onUpdate:checked-row-keys":e=>this.checkedRowKeys=e,"row-class-name":"items-workflow-instances"},null),l(T,{justify:"center"},{default:()=>[l(G,{page:this.page,"onUpdate:page":e=>this.page=e,"page-size":this.pageSize,"onUpdate:page-size":e=>this.pageSize=e,"page-count":this.totalPage,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:this.requestData,onUpdatePageSize:this.handleChangePageSize},null)]})]}),l(S,null,{default:()=>o("project.workflow.delete"),trigger:()=>l(H,{tag:"div",type:"primary",disabled:this.checkedRowKeys.length<=0,style:"position: absolute; bottom: 10px; left: 10px;",class:"btn-delete-all"},{default:()=>[l(X,{onPositiveClick:this.handleBatchDelete},{default:()=>o("project.workflow.delete_confirm"),trigger:()=>o("project.workflow.delete")})]})})]})]})}});export{ct as default};
