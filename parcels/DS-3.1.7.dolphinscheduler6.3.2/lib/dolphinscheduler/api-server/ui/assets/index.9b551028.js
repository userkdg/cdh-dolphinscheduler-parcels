import{u as g,a as M,e as S,w as b,t as i,b5 as T,d as _,at as U,ba as R,c as a,ak as v}from"./index.ccaa682a.js";import{D as I,C as u,c as L}from"./column-width-config.d330f121.js";import{N as O}from"./Dropdown.16d7f975.js";import{U as P}from"./UserOutlined.44a6680d.js";import{E as j}from"./EditOutlined.84f6aa5d.js";import{D}from"./DeleteOutlined.b64cb1c2.js";import{d as V}from"./Selection.57d091a8.js";import{N as y}from"./Tooltip.14e7654c.js";import{N as h}from"./Button.3394f0e3.js";import{N as f}from"./Icon.808259cb.js";import{N as A}from"./Popconfirm.b8629776.js";import{N as d}from"./Space.f435ce00.js";import{q as E,h as W}from"./index.204335d0.js";import{p as N}from"./common.0c468cf3.js";import{f as k}from"./index.15a20265.js";import{UserModal as q}from"./user-detail-modal.0942b951.js";import{AuthorizeModal as H}from"./authorize-modal.72d5626e.js";import{C as w}from"./index.76253dc2.js";import{S as x}from"./SearchOutlined.2201cd30.js";import{N as B}from"./Input.f12e0137.js";import{N as G,a as F}from"./DataTable.f685dba1.js";import"./lodash.02988b15.js";import"./Popover.b48d5d17.js";import"./index.99c68204.js";import"./flatten.995f807f.js";import"./Scrollbar.0dc514b7.js";import"./fade-in.cssr.ac08f6bb.js";import"./VResizeObserver.c3d2397d.js";import"./utils.381519a7.js";import"./format-length.a0cbed4d.js";import"./resolve-slot.d8d7b3cb.js";import"./use-compitable.d1fd83c6.js";import"./next-frame-once.e5ee25e8.js";import"./ChevronRight.efc71575.js";import"./fade-in-scale-up.cssr.5995d390.js";import"./use-keyboard.db487137.js";import"./index.7a579f81.js";import"./use-locale.ca4c738c.js";import"./use-rtl.d43d8217.js";import"./Suffix.584d00eb.js";import"./is-browser.f4bc45cf.js";import"./keysOf.10525521.js";import"./get-slot.7f666ba0.js";import"./service.ae1ed8a7.js";import"./SettingOutlined.675e55ec.js";import"./PauseCircleOutlined.f81cacab.js";import"./CloseCircleOutlined.7f4d3411.js";import"./CheckCircleOutlined.b6132804.js";import"./index.0c5e8c9e.js";import"./index.689fb55d.js";import"./index.c665300e.js";import"./index.c1fd473c.js";import"./Card.915ef7d2.js";import"./Form.b41344c3.js";import"./FormItem.6b297844.js";import"./Select.a0f44759.js";import"./RadioGroup.8830dbe4.js";import"./Radio.0f909e72.js";import"./index.fd192f71.js";import"./index.12862679.js";import"./index.97c7c8f2.js";import"./index.f349419b.js";import"./Checkbox.ff1b56b7.js";import"./RadioButton.84587554.js";import"./TreeSelect.8a08df17.js";import"./ArrowDown.c45c82c0.js";import"./Ellipsis.31968545.js";import"./Forward.6cc09413.js";function X(t){const{t:e}=g(),o=M({columns:[],tableWidth:I}),n=()=>{const c=[{title:"#",key:"index",render:(s,m)=>m+1,...u.index},{title:e("security.user.username"),key:"userName",className:"name",...u.userName},{title:e("security.user.user_type"),key:"userType",render:s=>s.userType==="GENERAL_USER"?e("security.user.ordinary_user"):e("security.user.administrator"),...u.type},{title:e("security.user.tenant_code"),key:"tenantCode",...u.name},{title:e("security.user.queue"),key:"queue",width:120},{title:e("security.user.email"),key:"email",...u.name},{title:e("security.user.phone"),key:"phone",width:140},{title:e("security.user.state"),key:"state",...u.state,render:(s,m)=>i(V,{type:s.state===1?"success":"error"},{default:()=>e(`security.user.state_${s.state===1?"enabled":"disabled"}`)})},{title:e("security.user.create_time"),key:"createTime",...u.time},{title:e("security.user.update_time"),key:"updateTime",...u.time},{title:e("security.user.operation"),key:"operation",...u.operation(3),render:(s,m)=>i(d,null,{default:()=>[i(O,{trigger:"click",options:[{label:e("security.user.project"),key:"authorize_project"},{label:e("security.user.resource"),key:"authorize_resource"},{label:e("security.user.datasource"),key:"authorize_datasource"},{label:e("security.user.udf"),key:"authorize_udf"},{label:e("security.user.namespace"),key:"authorize_namespace"}],onSelect:r=>void t({rowData:s,key:r},"authorize")},()=>i(y,{trigger:"hover"},{trigger:()=>i(h,{circle:!0,type:"warning",size:"small",class:"authorize"},{icon:()=>i(f,null,()=>i(P))}),default:()=>e("security.user.authorize")})),i(y,{trigger:"hover"},{trigger:()=>i(h,{circle:!0,type:"info",size:"small",class:"edit",onClick:()=>void t({rowData:s},"edit")},()=>i(f,null,()=>i(j))),default:()=>e("security.user.edit")}),i(A,{onPositiveClick:()=>void t({rowData:s},"delete")},{trigger:()=>i(y,{},{trigger:()=>i(h,{circle:!0,type:"error",size:"small",class:"delete"},{icon:()=>i(f,null,{default:()=>i(D)})}),default:()=>e("security.user.delete")}),default:()=>e("security.user.delete_confirm")})]})}];o.value={columns:c,tableWidth:L(c)}};return S(()=>{n()}),b(g().locale,()=>{n()}),{columnsRef:o,createColumns:n}}function $(){const t=T({page:1,pageSize:10,itemCount:0,searchVal:"",list:[],loading:!1,currentRecord:{},authorizeType:"authorize_project",detailModalShow:!1,authorizeModalShow:!1}),e=async()=>{if(t.loading)return;t.loading=!0;const{totalList:r,total:p}=await E({pageNo:t.page,pageSize:t.pageSize,searchVal:t.searchVal});if(t.loading=!1,!r)throw Error();t.list=r.map(l=>(l.createTime=l.createTime?k(N(l.createTime),"yyyy-MM-dd HH:mm:ss"):"",l.updateTime=l.updateTime?k(N(l.updateTime),"yyyy-MM-dd HH:mm:ss"):"",l.tenantId=l.tenantId===0?null:l.tenantId,l)),t.itemCount=p},o=()=>{t.list.length===1&&t.page>1&&--t.page,e()},n=async r=>{await W({id:r}),o()},c=(r,p)=>{t.currentRecord=r.rowData,p==="edit"&&(t.detailModalShow=!0),p==="authorize"&&r.key&&(t.authorizeModalShow=!0,t.authorizeType=r.key),p==="delete"&&n(r.rowData.id)},s=r=>{t.page=r,e()},m=r=>{t.page=1,t.pageSize=r,e()};return S(()=>{e()}),{state:t,changePage:s,changePageSize:m,updateList:o,onOperationClick:c}}function J(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!v(t)}const mt=_({name:"user-manage",setup(){var z;const{t}=g(),{state:e,changePage:o,changePageSize:n,updateList:c,onOperationClick:s}=$(),{columnsRef:m}=X(s),r=()=>{e.detailModalShow=!0,e.currentRecord=null},p=()=>{e.detailModalShow=!1},l=()=>{e.authorizeModalShow=!1},C=(z=U())==null?void 0:z.appContext.config.globalProperties.trim;return{t,columnsRef:m,...R(e),changePage:o,changePageSize:n,onAddUser:r,onUpdatedList:c,onDetailModalCancel:p,onAuthorizeModalCancel:l,trim:C}},render(){let t;return a(d,{vertical:!0},{default:()=>{var e;return[a(w,null,{default:()=>[a(d,{justify:"space-between"},{default:()=>[a(h,{onClick:this.onAddUser,type:"primary",class:"btn-create-user",size:"small"},J(t=this.t("security.user.create_user"))?t:{default:()=>[t]}),a(d,null,{default:()=>[a(B,{allowInput:this.trim,value:this.searchVal,"onUpdate:value":o=>this.searchVal=o,size:"small",clearable:!0},null),a(h,{type:"primary",size:"small",onClick:this.onUpdatedList},{default:()=>[a(f,null,{default:()=>[a(x,null,null)]})]})]})]})]}),a(w,{title:this.t("menu.user_manage")},{default:()=>[a(d,{vertical:!0},{default:()=>[a(G,{"row-class-name":"items",columns:this.columnsRef.columns,data:this.list,loading:this.loading,scrollX:this.columnsRef.tableWidth},null),a(d,{justify:"center"},{default:()=>[a(F,{page:this.page,"onUpdate:page":o=>this.page=o,"page-size":this.pageSize,"onUpdate:page-size":o=>this.pageSize=o,"item-count":this.itemCount,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,"on-update:page":this.changePage,"on-update:page-size":this.changePageSize},null)]})]})]}),a(q,{show:this.detailModalShow,currentRecord:this.currentRecord,onCancel:this.onDetailModalCancel,onUpdate:this.onUpdatedList},null),a(H,{show:this.authorizeModalShow,type:this.authorizeType,userId:(e=this.currentRecord)==null?void 0:e.id,onCancel:this.onAuthorizeModalCancel},null)]}})}});export{mt as default};
