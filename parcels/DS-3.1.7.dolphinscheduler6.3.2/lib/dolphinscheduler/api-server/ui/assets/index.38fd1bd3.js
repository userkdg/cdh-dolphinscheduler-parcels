import{u as T,b5 as B,a as c,bq as O,t as d,d as M,at as $,w as q,e as F,ba as A,c as a,bJ as G,ak as H}from"./index.ccaa682a.js";import{_ as E}from"./lodash.02988b15.js";import{u as J}from"./index.cb24df24.js";import{u as X}from"./use-text-copy.3e78d5d4.js";import{j as Q,k as Y,l as K,r as Z,f as ee,m as oe}from"./index.ea22358f.js";import te from"./table-action.f3bb11cc.js";import{s as re,S as ae}from"./start-modal.eb19d327.js";import{B as se}from"./index.c1fd473c.js";import{D as ie,C as l,c as le}from"./column-width-config.d330f121.js";import{C as ne}from"./CopyOutlined.3454e508.js";import{N as pe}from"./Ellipsis.31968545.js";import{N as w}from"./Space.f435ce00.js";import{N as P}from"./Icon.808259cb.js";import{N as f}from"./Button.3394f0e3.js";import{d as C}from"./Selection.57d091a8.js";import{C as I}from"./index.76253dc2.js";import ce from"./import-modal.5729aa95.js";import de from"./timing-modal.13645587.js";import me from"./version-modal.4361e6a9.js";import we from"./copy-modal.eed21738.js";import{S as fe}from"./SearchOutlined.2201cd30.js";import{N as he}from"./Input.f12e0137.js";import{N as ue,a as ke}from"./DataTable.f685dba1.js";import{N as D}from"./Tooltip.14e7654c.js";import{N as ge}from"./Popconfirm.b8629776.js";import"./use-message.f86e8236.js";import"./service.ae1ed8a7.js";import"./FormOutlined.bdfa4274.js";import"./PlayCircleOutlined.f08ba79f.js";import"./DownloadOutlined.e1724915.js";import"./InfoCircleFilled.bb7f9c24.js";import"./DeleteOutlined.b64cb1c2.js";import"./ApartmentOutlined.cc68b844.js";import"./Popover.b48d5d17.js";import"./index.99c68204.js";import"./flatten.995f807f.js";import"./Scrollbar.0dc514b7.js";import"./fade-in.cssr.ac08f6bb.js";import"./VResizeObserver.c3d2397d.js";import"./utils.381519a7.js";import"./format-length.a0cbed4d.js";import"./resolve-slot.d8d7b3cb.js";import"./use-compitable.d1fd83c6.js";import"./next-frame-once.e5ee25e8.js";import"./is-browser.f4bc45cf.js";import"./use-rtl.d43d8217.js";import"./use-locale.ca4c738c.js";import"./keysOf.10525521.js";import"./get-slot.7f666ba0.js";import"./index.7a579f81.js";import"./index.c665300e.js";import"./Card.915ef7d2.js";import"./fade-in-scale-up.cssr.5995d390.js";import"./use-modal.3beefbd6.js";import"./index.db4740c8.js";import"./index.8f0bc55d.js";import"./index.10c5a06c.js";import"./index.126e1851.js";import"./common.0c468cf3.js";import"./SettingOutlined.675e55ec.js";import"./PauseCircleOutlined.f81cacab.js";import"./CloseCircleOutlined.7f4d3411.js";import"./CheckCircleOutlined.b6132804.js";import"./EditOutlined.84f6aa5d.js";import"./index.15a20265.js";import"./ArrowUpOutlined.50724439.js";import"./PlusCircleOutlined.53e873cd.js";import"./Form.b41344c3.js";import"./FormItem.6b297844.js";import"./RadioGroup.8830dbe4.js";import"./Radio.0f909e72.js";import"./Select.a0f44759.js";import"./Checkbox.ff1b56b7.js";import"./RadioButton.84587554.js";import"./DatePicker.34177339.js";import"./use-keyboard.db487137.js";import"./Forward.6cc09413.js";import"./Switch.97f1d4b9.js";import"./Suffix.584d00eb.js";import"./Upload.06fb34f9.js";import"./Add.57f827bb.js";import"./Image.bab30061.js";import"./CloudUploadOutlined.bf33e501.js";import"./timezone.01550da9.js";import"./InputNumber.9bdbbaa6.js";import"./Tabs.b7cc94ed.js";import"./throttle.1a3a727c.js";import"./debounce.0c31022e.js";import"./toNumber.9dd28a65.js";import"./InputGroup.06ea3463.js";import"./ExclamationCircleOutlined.9cbc41f9.js";import"./ArrowDown.c45c82c0.js";import"./Dropdown.16d7f975.js";import"./ChevronRight.efc71575.js";import"./index.fd192f71.js";function ye(){const{t:s}=T(),n=O(),{copy:i}=X(),e=B({columns:[],tableWidth:ie,checkedRowKeys:[],row:{},tableData:[],projectCode:c(Number(n.currentRoute.value.params.projectCode)),page:c(1),pageSize:c(10),searchVal:c(),totalPage:c(1),showRef:c(!1),startShowRef:c(!1),timingShowRef:c(!1),versionShowRef:c(!1),copyShowRef:c(!1),loadingRef:c(!1)}),o=t=>{t.columns=[{type:"selection",className:"btn-selected",...l.selection},{title:"#",key:"id",...l.index,render:(r,p)=>p+1},{title:s("project.workflow.workflow_name"),key:"name",className:"workflow-name",...l.name,titleColSpan:2,render:r=>d(w,{justify:"space-between",wrap:!1,class:re["workflow-name"]},{default:()=>d(se,{onClick:()=>void n.push({name:"workflow-definition-detail",params:{code:r.code}})},{default:()=>d(pe,l.linkEllipsis,()=>r.name)})})},{title:"Copy",key:"copy",...l.copy,render:r=>d(f,{quaternary:!0,circle:!0,type:"info",size:"tiny",onClick:()=>void i(r.name)},{icon:()=>d(P,{size:16},()=>d(ne))})},{title:s("project.workflow.status"),key:"releaseState",...l.state,render:r=>r.releaseState==="ONLINE"?d(C,{type:"success",size:"small"},{default:()=>s("project.workflow.up_line")}):d(C,{type:"warning",size:"small"},{default:()=>s("project.workflow.down_line")})},{title:s("project.workflow.schedule_publish_status"),key:"scheduleReleaseState",...l.state,render:r=>r.scheduleReleaseState==="ONLINE"?d(C,{type:"success",size:"small"},{default:()=>s("project.workflow.up_line")}):r.scheduleReleaseState==="OFFLINE"?d(C,{type:"warning",size:"small"},{default:()=>s("project.workflow.down_line")}):"-"},{title:s("project.workflow.create_time"),key:"createTime",...l.time},{title:s("project.workflow.update_time"),key:"updateTime",...l.time},{title:s("project.workflow.description"),key:"description",...l.note},{title:s("project.workflow.create_user"),key:"userName",...l.userName},{title:s("project.workflow.modify_user"),key:"modifyBy",...l.userName},{title:s("project.workflow.operation"),key:"operation",...l.operation(10),render:r=>d(te,{row:r,onEditWorkflow:()=>y(r),onStartWorkflow:()=>S(r),onTimingWorkflow:()=>R(r),onVersionWorkflow:()=>N(r),onDeleteWorkflow:()=>m(r),onReleaseWorkflow:()=>_(r),onCopyWorkflow:()=>L(r),onExportWorkflow:()=>v(r),onGotoTimingManage:()=>j(r),onGotoWorkflowTree:()=>x(r)})}],t.tableWidth&&(t.tableWidth=le(t.columns))},y=t=>{e.row=t,n.push({name:"workflow-definition-detail",params:{code:t.code}})},S=t=>{e.startShowRef=!0,e.row=t},R=t=>{e.timingShowRef=!0,e.row=t},N=t=>{e.versionShowRef=!0,e.row=t},m=t=>{Q(e.projectCode,t.code).then(()=>{window.$message.success(s("project.workflow.success")),k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},z=()=>{const t={codes:E.join(e.checkedRowKeys,",")};Y(t,e.projectCode).then(()=>{window.$message.success(s("project.workflow.success")),e.tableData.length===e.checkedRowKeys.length&&e.page>1&&(e.page-=1),e.checkedRowKeys=[],k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},W=()=>{const t="workflow_"+new Date().getTime(),r={codes:E.join(e.checkedRowKeys,",")};K(r,e.projectCode).then(p=>{b(p,t),window.$message.success(s("project.workflow.success")),e.checkedRowKeys=[]})},U=()=>{},_=t=>{const r={name:t.name,releaseState:t.releaseState==="ONLINE"?"OFFLINE":"ONLINE"};Z(r,e.projectCode,t.code).then(()=>{window.$message.success(s("project.workflow.success")),k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},L=t=>{const r={codes:String(t.code),targetProjectCode:e.projectCode};ee(r,e.projectCode).then(()=>{window.$message.success(s("project.workflow.success")),k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},b=(t,r="json")=>{if(!t)return;const p=new Blob([t]),h=`${r}.json`;if("download"in document.createElement("a")){const V=window.URL.createObjectURL(p),u=document.createElement("a");u.style.display="none",u.href=V,u.setAttribute("download",h),document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(V)}else window.navigator.msSaveBlob&&window.navigator.msSaveBlob(p,h)},v=t=>{const r="workflow_"+new Date().getTime(),p={codes:String(t.code)};K(p,e.projectCode).then(h=>{b(h,r)})},j=t=>{n.push({name:"workflow-definition-timing",params:{projectCode:e.projectCode,definitionCode:t.code}})},x=t=>{n.push({name:"workflow-definition-tree",params:{projectCode:e.projectCode,definitionCode:t.code}})},k=t=>{if(e.loadingRef)return;e.loadingRef=!0;const{state:r}=J(oe({...t},e.projectCode).then(p=>{e.totalPage=p.totalPage,e.tableData=p.totalList.map(h=>({...h})),e.loadingRef=!1}),{total:0,table:[]});return r};return{variables:e,createColumns:o,getTableData:k,batchDeleteWorkflow:z,batchExportWorkflow:W,batchCopyWorkflow:U}}function g(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!H(s)}const nt=M({name:"WorkflowDefinitionList",setup(){var j;const s=O(),n=G(),i=Number(n.params.projectCode),{variables:e,createColumns:o,getTableData:y,batchDeleteWorkflow:S,batchExportWorkflow:R,batchCopyWorkflow:N}=ye(),m=()=>{y({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})},z=()=>{m()},W=()=>{e.checkedRowKeys=[],m()},U=()=>{e.page=1,m()},_=()=>{e.page=1,y({pageSize:e.pageSize,pageNo:e.page,searchVal:""})},L=()=>{e.page=1,m()},b=()=>{s.push({path:`/projects/${i}/workflow/definitions/create`})},v=(j=$())==null?void 0:j.appContext.config.globalProperties.trim;return q(T().locale,()=>{o(e)}),F(()=>{o(e),m()}),{requestData:m,handleSearch:U,onClearSearch:_,handleUpdateList:z,createDefinition:b,handleChangePageSize:L,batchDeleteWorkflow:S,batchExportWorkflow:R,batchCopyWorkflow:N,handleCopyUpdateList:W,...A(e),trim:v}},render(){let s,n;const{t:i}=T(),{loadingRef:e}=this;return a(w,{vertical:!0},{default:()=>[a(I,null,{default:()=>[a(w,{justify:"space-between"},{default:()=>[a(w,null,{default:()=>[a(f,{type:"primary",size:"small",onClick:this.createDefinition,class:"btn-create-process"},g(s=i("project.workflow.create_workflow"))?s:{default:()=>[s]}),a(f,{strong:!0,secondary:!0,size:"small",onClick:()=>this.showRef=!0},g(n=i("project.workflow.import_workflow"))?n:{default:()=>[n]})]}),a(w,null,{default:()=>[a(he,{allowInput:this.trim,size:"small",placeholder:i("resource.function.enter_keyword_tips"),value:this.searchVal,"onUpdate:value":o=>this.searchVal=o,clearable:!0,onClear:this.onClearSearch},null),a(f,{type:"primary",size:"small",onClick:this.handleSearch},{default:()=>[a(P,null,{default:()=>[a(fe,null,null)]})]})]})]})]}),a(I,{title:i("project.workflow.workflow_definition")},{default:()=>[a(w,{vertical:!0},{default:()=>[a(ue,{loading:e,rowKey:o=>o.code,columns:this.columns,data:this.tableData,striped:!0,"checked-row-keys":this.checkedRowKeys,"onUpdate:checked-row-keys":o=>this.checkedRowKeys=o,"row-class-name":"items",scrollX:this.tableWidth},null),a(w,{justify:"space-between"},{default:()=>[a(w,null,{default:()=>[a(D,null,{default:()=>i("project.workflow.delete"),trigger:()=>a(ge,{onPositiveClick:this.batchDeleteWorkflow},{default:()=>i("project.workflow.delete_confirm"),trigger:()=>{let o;return a(f,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,class:"btn-delete-all"},g(o=i("project.workflow.delete"))?o:{default:()=>[o]})}})}),a(D,null,{default:()=>i("project.workflow.export"),trigger:()=>{let o;return a(f,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,onClick:this.batchExportWorkflow,class:"btn-delete-all"},g(o=i("project.workflow.export"))?o:{default:()=>[o]})}}),a(D,null,{default:()=>i("project.workflow.batch_copy"),trigger:()=>{let o;return a(f,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,onClick:()=>this.copyShowRef=!0,class:"btn-delete-all"},g(o=i("project.workflow.batch_copy"))?o:{default:()=>[o]})}})]}),a(ke,{page:this.page,"onUpdate:page":o=>this.page=o,"page-size":this.pageSize,"onUpdate:page-size":o=>this.pageSize=o,"page-count":this.totalPage,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:this.requestData,onUpdatePageSize:this.handleChangePageSize},null)]})]})]}),a(ce,{show:this.showRef,"onUpdate:show":o=>this.showRef=o,onUpdateList:this.handleUpdateList},null),a(ae,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.startShowRef,"onUpdate:show":o=>this.startShowRef=o,onUpdateList:this.handleUpdateList},null),a(de,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.timingShowRef,"onUpdate:show":o=>this.timingShowRef=o,onUpdateList:this.handleUpdateList},null),a(me,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.versionShowRef,"onUpdate:show":o=>this.versionShowRef=o,onUpdateList:this.handleUpdateList},null),a(we,{codes:this.checkedRowKeys,"onUpdate:codes":o=>this.checkedRowKeys=o,show:this.copyShowRef,"onUpdate:show":o=>this.copyShowRef=o,onUpdateList:this.handleCopyUpdateList},null)]})}});export{nt as default};
