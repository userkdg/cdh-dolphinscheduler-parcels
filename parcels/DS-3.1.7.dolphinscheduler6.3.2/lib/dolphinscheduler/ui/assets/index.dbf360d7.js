import{u as F,bo as a,b5 as g,a as f,bu as u,w as I,d as w,e as v,at as U,ba as b,c as t,ak as N}from"./index.ccaa682a.js";import{g as C,u as _}from"./index.204335d0.js";import{C as R}from"./index.76253dc2.js";import{M as y}from"./index.c665300e.js";import M from"./info.ab1307c5.js";import{N as S}from"./Button.3394f0e3.js";import{N as x}from"./Form.b41344c3.js";import{N as l}from"./FormItem.6b297844.js";import{N as n}from"./Input.f12e0137.js";import"./service.ae1ed8a7.js";import"./lodash.02988b15.js";import"./Card.915ef7d2.js";import"./use-rtl.d43d8217.js";import"./resolve-slot.d8d7b3cb.js";import"./index.7a579f81.js";import"./keysOf.10525521.js";import"./index.c1fd473c.js";import"./index.99c68204.js";import"./flatten.995f807f.js";import"./Scrollbar.0dc514b7.js";import"./fade-in.cssr.ac08f6bb.js";import"./VResizeObserver.c3d2397d.js";import"./fade-in-scale-up.cssr.5995d390.js";import"./utils.381519a7.js";import"./is-browser.f4bc45cf.js";import"./Space.f435ce00.js";import"./get-slot.7f666ba0.js";import"./format-length.a0cbed4d.js";import"./use-locale.ca4c738c.js";import"./Suffix.584d00eb.js";function q(){const{t:e,locale:i}=F(),r=a().userInfo,o=g({profileFormRef:f(),profileForm:{username:r.userName,email:r.email,phone:r.phone},saving:!1,rules:{username:{trigger:["input","blur"],required:!0,validator(){if(o.profileForm.username==="")return new Error(e("profile.username_tips"))}},email:{trigger:["input","blur"],required:!0,validator(){if(o.profileForm.email==="")return new Error(e("profile.email_tips"));if(!u.regex.email.test(o.profileForm.email||""))return new Error(e("profile.email_correct_tips"))}}}});return I(r,()=>{o.profileForm={username:r.userName,email:r.email,phone:r.phone}}),{state:o,t:e,locale:i}}function j(){const e=a();return{getUserInfo:async()=>{const r=await C();await e.setUserInfo(r)}}}function E(e){const r=a().userInfo;return{handleUpdate:async()=>{if(await e.profileFormRef.validate(),e.saving!==!0){e.saving=!0;try{await _({userPassword:"",id:r.id,userName:e.profileForm.username,tenantId:r.tenantId,email:e.profileForm.email,phone:e.profileForm.phone,state:r.state,queue:r.queue}),e.saving=!1}catch{e.saving=!1}}}}}function k(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!N(e)}const fe=w({name:"profile",setup(){var p;const e=a().userInfo,i=f(!1),{state:r,t:o}=q(),{handleUpdate:s}=E(r),{getUserInfo:m}=j();v(async()=>{await m()});const c=()=>{i.value=!1,r.profileForm.email=e.email,r.profileForm.phone=e.phone,r.profileForm.username=e.userName},d=async()=>{i.value=!1,await s(),await m()},h=(p=U())==null?void 0:p.appContext.config.globalProperties.trim;return{...b(r),showModalRef:i,t:o,onCancel:c,onConfirm:d,trim:h}},render(){const{t:e,onCancel:i,onConfirm:r}=this;return t("div",null,[t(R,{title:e("profile.profile")},{default:()=>t(M,null,null),"header-extra":()=>{let o;return t(S,{type:"info",size:"small",onClick:()=>this.showModalRef=!this.showModalRef},k(o=e("profile.edit"))?o:{default:()=>[o]})}}),t(y,{title:e("profile.edit_profile"),show:this.showModalRef,onCancel:i,onConfirm:r,confirmDisabled:!this.profileForm.username||!this.profileForm.email||!u.regex.email.test(this.profileForm.email),confirmLoading:this.saving},{default:()=>t(x,{rules:this.rules,ref:"profileFormRef"},{default:()=>[t(l,{label:e("profile.username"),path:"username"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.username,"onUpdate:value":o=>this.profileForm.username=o,placeholder:e("profile.username_tips")},null)]}),t(l,{label:e("profile.email"),path:"email"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.email,"onUpdate:value":o=>this.profileForm.email=o,placeholder:e("profile.email_tips")},null)]}),t(l,{label:e("profile.phone"),path:"phone"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.phone,"onUpdate:value":o=>this.profileForm.phone=o,placeholder:e("profile.phone_tips")},null)]})]})})])}});export{fe as default};
