import{M as _}from"./index.c665300e.js";import{u as h,b5 as b,a as r,d as v,at as k,w as g,ba as M,c as n}from"./index.ccaa682a.js";import{v as C,c as w,u as R}from"./index.263d6e39.js";import{N}from"./Form.b41344c3.js";import{N as l}from"./FormItem.6b297844.js";import{N as c}from"./Input.f12e0137.js";import"./index.c1fd473c.js";import"./Button.3394f0e3.js";import"./is-browser.f4bc45cf.js";import"./use-rtl.d43d8217.js";import"./resolve-slot.d8d7b3cb.js";import"./keysOf.10525521.js";import"./Card.915ef7d2.js";import"./index.7a579f81.js";import"./index.99c68204.js";import"./flatten.995f807f.js";import"./Scrollbar.0dc514b7.js";import"./fade-in.cssr.ac08f6bb.js";import"./VResizeObserver.c3d2397d.js";import"./fade-in-scale-up.cssr.5995d390.js";import"./utils.381519a7.js";import"./Space.f435ce00.js";import"./get-slot.7f666ba0.js";import"./service.ae1ed8a7.js";import"./lodash.02988b15.js";import"./format-length.a0cbed4d.js";import"./use-locale.ca4c738c.js";import"./Suffix.584d00eb.js";function S(t,i){const{t:o}=h(),e=b({clusterFormRef:r(),model:{code:r(-1),name:r(""),k8s_config:r(""),yarn_config:r(""),description:r("")},saving:!1,rules:{name:{required:!0,trigger:["input","blur"],validator(){if(e.model.name==="")return new Error(o("security.cluster.cluster_name_tips"))}},description:{required:!0,trigger:["input","blur"],validator(){if(e.model.description==="")return new Error(o("security.cluster.cluster_description_tips"))}}}}),d=async s=>{if(await e.clusterFormRef.validate(),!e.saving){e.saving=!0;try{s===0?await m():await u()}finally{e.saving=!1}}},m=()=>{C({clusterName:e.model.name}).then(()=>{const s={name:e.model.name,config:JSON.stringify({k8s:e.model.k8s_config,yarn:e.model.yarn_config}),description:e.model.description};w(s).then(()=>{e.model.name="",e.model.k8s_config="",e.model.yarn_config="",e.model.description="",i.emit("confirmModal",t.showModalRef)})})},u=()=>{const s={code:e.model.code,name:e.model.name,config:JSON.stringify({k8s:e.model.k8s_config,yarn:e.model.yarn_config}),description:e.model.description};R(s).then(()=>{i.emit("confirmModal",t.showModalRef)})};return{variables:e,handleValidate:d}}const I=`apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CZJQ0FURS0tLS0tCg==
    server: https://127.0.0.1:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: {}
users:
- name: kubernetes-admin
  user:
    client-certificate-data: LS0tLS1CZJQ0FURS0tLS0tCg= 
`,F="In development...",ne=v({name:"ClusterModal",props:{showModalRef:{type:Boolean,default:!1},statusRef:{type:Number,default:0},row:{type:Object,default:{}}},emits:["cancelModal","confirmModal"],setup(t,i){var f;const{variables:o,handleValidate:e}=S(t,i),{t:d}=h(),m=()=>{t.statusRef===0&&(o.model.name="",o.model.k8s_config="",o.model.yarn_config="",o.model.description=""),i.emit("cancelModal",t.showModalRef)},u=()=>{e(t.statusRef)},s=a=>{if(o.model.code=a.code,o.model.name=a.name,a.config){const p=JSON.parse(a.config);o.model.k8s_config=p.k8s||"",o.model.yarn_config=p.yarn||""}else o.model.k8s_config="",o.model.yarn_config="";o.model.description=a.description},y=(f=k())==null?void 0:f.appContext.config.globalProperties.trim;return g(()=>t.statusRef,()=>{t.statusRef===0?(o.model.name="",o.model.k8s_config="",o.model.yarn_config="",o.model.description=""):s(t.row)}),g(()=>t.row,()=>{s(t.row)}),{t:d,...M(o),cancelModal:m,confirmModal:u,trim:y}},render(){const{t}=this;return n("div",null,[n(_,{title:this.statusRef===0?t("security.cluster.create_cluster"):t("security.cluster.edit_cluster"),show:this.showModalRef,onCancel:this.cancelModal,onConfirm:this.confirmModal,confirmDisabled:!this.model.name||!this.model.description,confirmClassName:"btn-submit",cancelClassName:"btn-cancel",confirmLoading:this.saving},{default:()=>n(N,{model:this.model,rules:this.rules,ref:"clusterFormRef"},{default:()=>[n(l,{label:t("security.cluster.cluster_name"),path:"name"},{default:()=>[n(c,{allowInput:this.trim,class:"input-cluster-name",placeholder:t("security.cluster.cluster_name_tips"),value:this.model.name,"onUpdate:value":i=>this.model.name=i},null)]}),n(l,{label:t("security.cluster.kubernetes_config"),path:"k8s_config"},{default:()=>[n(c,{allowInput:this.trim,class:"input-cluster-config",placeholder:I,type:"textarea",autosize:{minRows:16},value:this.model.k8s_config,"onUpdate:value":i=>this.model.k8s_config=i},null)]}),n(l,{label:t("security.cluster.yarn_config"),path:"yarn_config"},{default:()=>[n(c,{allowInput:this.trim,class:"input-yarn-config",placeholder:F,disabled:!0,value:this.model.yarn_config,"onUpdate:value":i=>this.model.yarn_config=i},null)]}),n(l,{label:t("security.cluster.cluster_desc"),path:"description"},{default:()=>[n(c,{allowInput:this.trim,class:"input-cluster-desc",placeholder:t("security.cluster.cluster_description_tips"),value:this.model.description,"onUpdate:value":i=>this.model.description=i},null)]})]})})])}});export{ne as default};
