import{u as T,t as v,bq as j,d as K,a as h,b5 as L,e as w,at as Q,c as o,ak as Y}from"./index.ccaa682a.js";import{e as Z}from"./common.0c468cf3.js";import{u as x}from"./file.4d291ef4.js";import ee from"./table-action.e66fd1a0.js";import{B as te}from"./index.c1fd473c.js";import{C as f,c as ae,D as oe}from"./column-width-config.d330f121.js";import{N as ie}from"./Ellipsis.31968545.js";import{u as U}from"./index.cb24df24.js";import{d as re,v as se,e as F,f as le}from"./index.97c7c8f2.js";import{C as P}from"./index.76253dc2.js";import ne from"./index.a0cf8ded.js";import ue from"./index.28163310.js";import pe from"./index.a43fba68.js";import{s as B}from"./index.module.b13963ba.js";import{N as me}from"./ButtonGroup.121b6732.js";import{S as ce}from"./SearchOutlined.2201cd30.js";import{N as de,a as D}from"./BreadcrumbItem.2eb2f05f.js";import{N as R}from"./Space.f435ce00.js";import{N as b}from"./Button.3394f0e3.js";import{N as fe}from"./Input.f12e0137.js";import{N as he}from"./Icon.808259cb.js";import{N as ge,a as Ne}from"./DataTable.f685dba1.js";import"./lodash.02988b15.js";import"./SettingOutlined.675e55ec.js";import"./PauseCircleOutlined.f81cacab.js";import"./CloseCircleOutlined.7f4d3411.js";import"./CheckCircleOutlined.b6132804.js";import"./EditOutlined.84f6aa5d.js";import"./index.15a20265.js";import"./FormOutlined.bdfa4274.js";import"./DownloadOutlined.e1724915.js";import"./InfoCircleFilled.bb7f9c24.js";import"./DeleteOutlined.b64cb1c2.js";import"./Tooltip.14e7654c.js";import"./Popover.b48d5d17.js";import"./index.99c68204.js";import"./flatten.995f807f.js";import"./Scrollbar.0dc514b7.js";import"./fade-in.cssr.ac08f6bb.js";import"./VResizeObserver.c3d2397d.js";import"./utils.381519a7.js";import"./format-length.a0cbed4d.js";import"./resolve-slot.d8d7b3cb.js";import"./use-compitable.d1fd83c6.js";import"./next-frame-once.e5ee25e8.js";import"./Popconfirm.b8629776.js";import"./use-locale.ca4c738c.js";import"./keysOf.10525521.js";import"./service.ae1ed8a7.js";import"./Card.915ef7d2.js";import"./use-rtl.d43d8217.js";import"./index.7a579f81.js";import"./index.c665300e.js";import"./fade-in-scale-up.cssr.5995d390.js";import"./is-browser.f4bc45cf.js";import"./Form.b41344c3.js";import"./FormItem.6b297844.js";import"./get-slot.7f666ba0.js";import"./Suffix.584d00eb.js";import"./Upload.06fb34f9.js";import"./Add.57f827bb.js";import"./Image.bab30061.js";import"./ArrowDown.c45c82c0.js";import"./Checkbox.ff1b56b7.js";import"./RadioGroup.8830dbe4.js";import"./Radio.0f909e72.js";import"./Dropdown.16d7f975.js";import"./ChevronRight.efc71575.js";import"./Selection.57d091a8.js";import"./use-keyboard.db487137.js";import"./Select.a0f44759.js";import"./Forward.6cc09413.js";const Re=(r,a)=>{const e=x();e.setFileInfo(`${a.alias}|${a.size}`),a.directory?(e.setCurrentDir(`${a.fullName}`),r.push({name:"resource-file-subdirectory",params:{id:a.id}})):r.push({name:"resource-file-list",params:{id:a.id}})};function Se(r,a){const{t:e}=T(),u=j(),c=[{title:"#",key:"id",...f.index,render:(s,p)=>p+1},{title:e("resource.file.name"),key:"name",...f.linkName,render:s=>v(te,{onClick:()=>void Re(u,s)},{default:()=>v(ie,f.linkEllipsis,()=>s.name)})},{title:e("resource.file.user_name"),...f.userName,key:"user_name"},{title:e("resource.file.whether_directory"),key:"whether_directory",...f.yesOrNo,render:s=>s.directory?e("resource.file.yes"):e("resource.file.no")},{title:e("resource.file.file_name"),...f.name,key:"file_name"},{title:e("resource.file.description"),...f.note,key:"description"},{title:e("resource.file.size"),key:"size",...f.size,render:s=>Z(s.size)},{title:e("resource.file.update_time"),...f.time,key:"update_time"},{title:e("resource.file.operation"),key:"operation",render:s=>v(ee,{row:s,onRenameResource:(p,d,n)=>r(p,d,n),onUpdateList:()=>a()}),...f.operation(4)}];return{columnsRef:c,tableWidth:ae(c)||oe}}function ye(r={}){return{getResourceListState:(u=-1,c="",s=1,p=10)=>{const{state:d}=U(re({id:u,type:"FILE",searchVal:c,pageNo:s,pageSize:p}).then(n=>{const{total:g}=n;r(g);const l=n.totalList.map(t=>({id:t.id,name:t.alias,alias:t.alias,fullName:t.fullName,type:t.type,user_name:t.userName,directory:t.directory,file_name:t.fileName,description:t.description,size:t.size,update_time:t.updateTime}));return{total:g,table:l}}),{total:0,table:[]});return d},getResourceView:u=>{const c={skipLineNum:0,limit:3e3},{state:s}=U(se(c,u),{});return s}}}function z(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!Y(r)}const qt=K({name:"File",setup(){var _;const r=j(),a=h(Number(r.currentRoute.value.params.id)||-1),e=h(),u=h(!1),c=h(!1),s=h(!1),p=h(),d=L({id:-1,name:"",description:""}),n=L({page:1,pageSize:10,itemCount:0,pageSizes:[10,30,50]}),g=i=>{n.page=i,e.value=N(a.value,p.value,n.page,n.pageSize)},l=i=>{n.page=1,n.pageSize=i,e.value=N(a.value,p.value,n.page,n.pageSize)},t=i=>{i.value=!0},M=i=>{n.itemCount=i},{getResourceListState:N}=ye(M),O=()=>{e.value=N(a.value,p.value)},q=()=>{t(u)},W=()=>{const i=a.value?"resource-subfile-create":"resource-file-create";r.push({name:i,params:{id:a.value}})},E=()=>{t(c)},G=(i,m,y)=>{d.id=i,d.name=m,d.description=y,t(s)},V=()=>{r.push({name:"file-manage"})},$=()=>{e.value=N(a.value,p.value)},C=x();w(()=>{e.value=N(a.value)});const S=h([{id:1,fullName:"l1"},{id:2,fullName:"l2"},{id:4,fullName:"l3"}]),A=(_=Q())==null?void 0:_.appContext.config.globalProperties.trim;w(()=>{const i=Number(r.currentRoute.value.params.id)||-1;i===-1?C.setCurrentDir("/"):F(i).then(m=>{m.fullName&&C.setCurrentDir(m.fullName)})});const H=async i=>{var y,k;let m=0;for(const X of i){const I=i.slice(0,m+1).join("/");if(I){const J=await le({id:0,type:"FILE",fullName:I},0);(y=S.value)==null||y.push({id:J.id,fullName:X})}else(k=S.value)==null||k.push({id:0,fullName:"Root"});m=m+1}};return w(()=>{S.value=[],a.value!=-1&&F(a.value).then(i=>{if(i.fullName){const m=i.fullName.split("/");m&&m.length>1&&H(m)}})}),{fileId:a,searchRef:p,folderShowRef:u,uploadShowRef:c,renameShowRef:s,handleShowModal:t,resourceListRef:e,updateList:$,handleConditions:O,handleCreateFolder:q,handleCreateFile:W,handleUploadFile:E,handleRenameFile:G,handleUpdatePage:g,handleUpdatePageSize:l,handleGoRoot:V,pagination:n,renameInfo:d,breadcrumbItemsRef:S,trim:A}},render(){let r,a,e;const{t:u}=T(),{columnsRef:c,tableWidth:s}=Se(this.handleRenameFile,this.updateList),{handleConditions:p,handleCreateFolder:d,handleCreateFile:n,handleUploadFile:g}=this;return o(R,{vertical:!0},{default:()=>[o(P,null,{default:()=>[o(R,{justify:"space-between"},{default:()=>[o(me,{size:"small"},{default:()=>[o(b,{onClick:d,class:"btn-create-directory"},z(r=u("resource.file.create_folder"))?r:{default:()=>[r]}),o(b,{onClick:n,class:"btn-create-file"},z(a=u("resource.file.create_file"))?a:{default:()=>[a]}),o(b,{onClick:g,class:"btn-upload-file"},z(e=u("resource.file.upload_files"))?e:{default:()=>[e]})]}),o(R,null,{default:()=>[o(fe,{size:"small",allowInput:this.trim,placeholder:u("resource.file.enter_keyword_tips"),value:this.searchRef,"onUpdate:value":l=>this.searchRef=l},null),o(b,{size:"small",type:"primary",onClick:p},{default:()=>[o(he,null,{default:()=>[o(ce,null,null)]})]})]})]})]}),o(P,{title:u("resource.file.file_manage")},{"header-extra":()=>o(de,{separator:">",class:B.breadcrumb},{default:()=>{var l;return[(l=this.breadcrumbItemsRef)==null?void 0:l.map(t=>t.id===0?o(D,null,{default:()=>[o("span",{onClick:this.handleGoRoot},[t.fullName])]}):o(D,{href:t.id.toString()},{default:()=>[t.fullName]}))]}}),default:()=>o(R,{vertical:!0},{default:()=>{var l;return[o(ge,{remote:!0,columns:c,data:(l=this.resourceListRef)==null?void 0:l.value.table,striped:!0,size:"small",class:B["table-box"],"row-class-name":"items",scrollX:s},null),o(R,{justify:"center"},{default:()=>[o(Ne,{page:this.pagination.page,"onUpdate:page":t=>this.pagination.page=t,pageSize:this.pagination.pageSize,"onUpdate:pageSize":t=>this.pagination.pageSize=t,pageSizes:this.pagination.pageSizes,"item-count":this.pagination.itemCount,onUpdatePage:this.handleUpdatePage,onUpdatePageSize:this.handleUpdatePageSize,"show-quick-jumper":!0,"show-size-picker":!0},null)]})]}})}),o(ne,{show:this.folderShowRef,"onUpdate:show":l=>this.folderShowRef=l,onUpdateList:this.updateList},null),o(ue,{show:this.uploadShowRef,"onUpdate:show":l=>this.uploadShowRef=l,onUpdateList:this.updateList},null),o(pe,{show:this.renameShowRef,"onUpdate:show":l=>this.renameShowRef=l,id:this.renameInfo.id,name:this.renameInfo.name,description:this.renameInfo.description,onUpdateList:this.updateList},null)]})}});export{qt as default};
