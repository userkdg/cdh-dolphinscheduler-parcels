import{d as w,b7 as b,b8 as N,b9 as V,u as C,bJ as _,b5 as j,a as p,t as s,w as g,ba as T,c}from"./index.ccaa682a.js";import{u as y}from"./index.cb24df24.js";import{c as z,e as P,f as S}from"./index.f525e57e.js";import{D as x}from"./DeleteOutlined.b64cb1c2.js";import{d as R}from"./Selection.57d091a8.js";import{N as h}from"./Popconfirm.b8629776.js";import{N as k}from"./Tooltip.14e7654c.js";import{N as v}from"./Button.3394f0e3.js";import{N as f}from"./Space.f435ce00.js";import{M as B}from"./index.c665300e.js";import{N as M,a as O}from"./DataTable.f685dba1.js";import"./service.ae1ed8a7.js";import"./lodash.02988b15.js";import"./VResizeObserver.c3d2397d.js";import"./Popover.b48d5d17.js";import"./index.99c68204.js";import"./flatten.995f807f.js";import"./Scrollbar.0dc514b7.js";import"./fade-in.cssr.ac08f6bb.js";import"./utils.381519a7.js";import"./format-length.a0cbed4d.js";import"./resolve-slot.d8d7b3cb.js";import"./use-compitable.d1fd83c6.js";import"./next-frame-once.e5ee25e8.js";import"./index.7a579f81.js";import"./use-locale.ca4c738c.js";import"./use-rtl.d43d8217.js";import"./Suffix.584d00eb.js";import"./keysOf.10525521.js";import"./is-browser.f4bc45cf.js";import"./get-slot.7f666ba0.js";import"./index.c1fd473c.js";import"./Card.915ef7d2.js";import"./fade-in-scale-up.cssr.5995d390.js";import"./ArrowDown.c45c82c0.js";import"./Checkbox.ff1b56b7.js";import"./RadioGroup.8830dbe4.js";import"./Radio.0f909e72.js";import"./Dropdown.16d7f975.js";import"./Icon.808259cb.js";import"./ChevronRight.efc71575.js";import"./use-keyboard.db487137.js";import"./Ellipsis.31968545.js";import"./Input.f12e0137.js";import"./Select.a0f44759.js";import"./Forward.6cc09413.js";const q={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},L=V("path",{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5L207 474a32 32 0 0 0-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z",fill:"currentColor"},null,-1),U=[L],$=w({name:"CheckOutlined",render:function(n,a){return b(),N("svg",q,U)}});function A(){const{t:e}=C(),n=_(),a=Number(n.params.projectCode),r=i=>{i.columns=[{title:"#",key:"index",render:(t,d)=>d+1},{title:e("project.task.version"),key:"version",render:t=>s("span",null,t.version!==i.taskVersion?"v"+t.version:s(R,{type:"success",size:"small"},{default:()=>`v${t.version} ${e("project.task.current_version")}`}))},{title:e("project.task.description"),key:"description",render:t=>s("span",null,t.description?t.description:"-")},{title:e("project.task.create_time"),key:"createTime"},{title:e("project.task.operation"),key:"operation",render(t){return s(f,null,{default:()=>[s(h,{onPositiveClick:()=>{l(t)}},{trigger:()=>s(k,{},{trigger:()=>s(v,{circle:!0,type:"info",size:"small",disabled:t.version===i.taskVersion},{icon:()=>s($)}),default:()=>e("project.task.switch_version")}),default:()=>e("project.task.confirm_switch_version")}),s(h,{onPositiveClick:()=>{m(t)}},{trigger:()=>s(k,{},{trigger:()=>s(v,{circle:!0,type:"error",size:"small",disabled:t.version===i.taskVersion},{icon:()=>s(x)}),default:()=>e("project.task.delete")}),default:()=>e("project.task.delete_confirm")})]})}}]},o=j({columns:[],tableData:[],page:p(1),pageSize:p(10),totalPage:p(1),taskVersion:p(null),taskCode:p(null),refreshTaskDefinition:p(!1),row:{},loadingRef:p(!1)}),l=i=>{z({version:i.version},{code:o.taskCode},{projectCode:a}).then(()=>{o.refreshTaskDefinition=!0})},m=i=>{P({version:i.version},{code:o.taskCode},{projectCode:a}).then(()=>{o.refreshTaskDefinition=!0})};return{variables:o,getTableData:i=>{if(o.loadingRef)return;o.loadingRef=!0;const{state:t}=y(S({...i},{code:o.taskCode},{projectCode:a}).then(d=>{o.tableData=d.totalList.map((D,H)=>({...D})),o.totalPage=d.totalPage,o.loadingRef=!1}),{});return t},createColumns:r}}const E={show:{type:Boolean,default:!1},row:{type:Object,default:{}}},Oe=w({name:"VersionModal",props:E,emits:["confirm","refresh"],setup(e,n){const{t:a}=C(),{variables:r,getTableData:o,createColumns:l}=A(),m=()=>{o({pageSize:r.pageSize,pageNo:r.page})};g(()=>e.show,()=>{var i,t;e.show&&(r.taskVersion=(i=e.row)==null?void 0:i.taskVersion,r.taskCode=(t=e.row)==null?void 0:t.taskCode,l(r),m())}),g(()=>r.refreshTaskDefinition,()=>{r.refreshTaskDefinition&&(n.emit("refresh"),r.refreshTaskDefinition=!1)});const u=()=>{n.emit("confirm")};return{t:a,...T(r),requestData:m,onConfirm:u}},render(){const{t:e,requestData:n,onConfirm:a,show:r,loadingRef:o}=this;return c(B,{show:r,title:e("project.task.version"),cancelShow:!1,onConfirm:a},{default:()=>[c(f,{vertical:!0},{default:()=>[c(M,{loading:o,columns:this.columns,data:this.tableData},null),c(f,{justify:"center"},{default:()=>[c(O,{page:this.page,"onUpdate:page":l=>this.page=l,"page-size":this.pageSize,"onUpdate:page-size":l=>this.pageSize=l,"page-count":this.totalPage,onUpdatePage:n},null)]})]})]})}});export{Oe as default};
